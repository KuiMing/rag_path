<!doctype html>
<html>
  <head>
    <!-- Metadata about the presentation -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>rag-path</title>

    <meta name="description" content="RAG 的修煉之路：爬、嵌、問，一氣呵成！">
    <meta name="author" content="Ben Chen">

    <!-- Presentation Styles -->
    <link rel="stylesheet" href="static/revealjs/dist/reset.css">
    <link rel="stylesheet" href="static/revealjs/dist/reveal.css">

    
      <link rel="stylesheet" href="static/revealjs/dist/theme/black.css" id="theme">
    

    

    <!-- Theme used for syntax highlighted code -->
    <link rel="stylesheet" href="static/revealjs/plugin/highlight/monokai.css" id="highlight-theme">
  </head>

  <body>
    <!-- Presentation body -->
    <div class="reveal">

      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">
        
          
            
              <section data-markdown>
                <textarea data-template>
                  # RAG 的修煉之路
# 爬、嵌、問
# 一氣呵成！


2025/03/01 陳奎銘 Ben 



                </textarea>
              </section>
            
          
        
          
            
              <section data-markdown>
                <textarea data-template>
                  




<!-- .slide: data-background-iframe="media/Ben.html" -->



                </textarea>
              </section>
            
          
        
          
            
              <section data-markdown>
                <textarea data-template>
                  



<!-- .slide: data-auto-animate -->

## Outline

- 前言
- 爬
- 嵌
- 問



                </textarea>
              </section>
            
          
        
          
            <section>
              
                <section data-markdown>
                  <textarea data-template>
                    

<!-- .slide: data-auto-animate -->
# 前言
RAG 之前與之後

- <font color='#646464'>爬</font>
- <font color='#646464'>嵌</font>
- <font color='#646464'>問</font>




                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

<font color='#FF2D2D'>Retrival</font>-<font color='#66B3FF'>Augmented</font> <font color='#79FF79'>Generation</font>
## 透過<font color='#FF2D2D'>檢索</font><font color='#66B3FF'>加強</font><font color='#79FF79'>生成</font>答案的能力

#### ⮕ 利用向量搜尋 <!-- .element: class="fragment" data-fragment-index="2" -->


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

#### `Cosine Similarity`

$$
 \cos(\theta) = \frac{A \cdot B}{\|A\| \|B\|} = \frac{\sum_{i=1}^{n} A_i B_i}{\sqrt{\sum_{i=1}^{n} A_i^2} \sqrt{\sum_{i=1}^{n} B_i^2}}
$$

![](media/cos_similarity.png)


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

### `Retrival-Augmented Generation`

- 結合『檢索』和『生成』，從外部知識中獲取答案
- 首先，將文件轉換成向量，存入向量資料庫
- 透過 cosine similarity 找到與問題最相近的片段
- 檢索 ⮕ 生成 ⮕ 回應


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    


<!-- .slide: data-background-iframe="media/RAG_2025.html" -->



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    


## 實務上的 RAG 需求

![](media/rag_path.png)




                  </textarea>
                </section>
              
            </section>
          
        
          
            <section>
              
                <section data-markdown>
                  <textarea data-template>
                    



- <font color='#646464'>前言</font>
# 爬- 爬蟲
    - 拿到網頁
    - 爬梳資料
- <font color='#646464'>嵌</font>
- <font color='#646464'>問</font>



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## 拿到網頁


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## 以前拿到網頁的手段


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

<!-- .slide: data-background="media/developer_tool.png" -->


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

<!-- .slide: data-background="media/postman.png" -->



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## 現在可以試試`singlefile`


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

### `singlefile`



<iframe width="560" height="315" src="https://www.youtube.com/embed/oVvTmcwxvmc?si=W4KsSx5uWN_MTIlX" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

### `singlefile`

```bash
# Install with Docker
docker pull capsulecode/singlefile
docker tag capsulecode/singlefile singlefile
# Run singlefile
docker run singlefile "https://www.wikipedia.org"
```

https://github.com/gildas-lormeau/single-file-cli




                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    


## 爬梳資料


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## 以前爬梳資料的手段


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

<!-- .slide: data-background="media/xpath_helper.png" -->



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

### beautyful soup

```python
from bs4 import BeautifulSoup

res = requests.get("https://xxxx.com")
soup = BeautifulSoup(res.content.decode("MS950"), "html.parser")
table_rows = soup.find_all("tr")
```


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## 現在我們可以試試 LLM + Structured Outputs





                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

### Structured Outputs

```python
from pydantic import BaseModel

class Ingredient(BaseModel):
    name: str
    quantity: str
    unit: str
    preparation: str

class Step(BaseModel):
    description: str

class Recipe(BaseModel):
    title: str
    ingredients: list[Ingredient]
    steps: Step
```


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

### Structured Outputs

- Reliable type-safety
- Explicit refusals
- Simpler prompting




                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

<!-- .slide: data-background="media/espn.png" -->


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

# Example

```python [10-14|16-17|19-26|28-36]
import subprocess
from pydantic import BaseModel
from openai import OpenAI
from dotenv import find_dotenv, load_dotenv
from markdownify import markdownify as md
import pandas as pd

load_dotenv(find_dotenv())

#  先用 singlefile 抓下網頁
html_content = subprocess.run(
    ["docker", "run", "singlefile", 
    "https://espn.com/soccer/commentary/_/gameId/704489"], 
    capture_output=True)

# 將網頁變成 Markdown
content = md(html_content.stdout.decode(), strip=["a", "img"])

# 定義結構
class Commentary(BaseModel):
    time: str
    text: str

class Match(BaseModel):
    commentaries: list[Commentary]

# 取得結果
completion = client.beta.chat.completions.parse(
    model="gpt-4o-2024-08-06",
    messages=[
        {"role": "system", "content": "Extract commentaries from the given passage. Do not fabricate any information."},
        {"role": "user", "content": f"Passage:{content}"},
    ],
    response_format=Match, #依照 class 結構擷取資料
)

event = completion.choices[0].message.parsed

commentaries = pd.DataFrame(event.dict()['commentaries'])

```


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

### Result
![](media/espn_table.png)


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

### 也可以試試 youtube


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

### 擷取 youtube 字幕

```python [6|32-36|92-105|111-126]
from urllib.parse import parse_qs
from urllib.parse import urlparse
from openai import OpenAI
from yt_dlp import YoutubeDL
import timeout_decorator
from youtube_transcript_api import YouTubeTranscriptApi
from dotenv import find_dotenv, load_dotenv


DEFAULT_LANGUAGES = ["zh-TW", "zh-Hant", "zh", "zh-Hans", "ja", "en", "ko"]


ALLOWED_NETLOCS = {
    "youtu.be",
    "m.youtube.com",
    "youtube.com",
    "www.youtube.com",
    "www.youtube-nocookie.com",
    "vid.plus",
}


class YoutubeLoader:
    def __init__(self, languages: list[str] | None = None) -> None:
        self.languages = languages or DEFAULT_LANGUAGES

    @timeout_decorator.timeout(20)
    def load(self, url: str) -> str:
 
        video_id = parse_video_id(url)

        # 擷取字幕
        transcript_pieces: list[dict[str, str | float]] = (
            YouTubeTranscriptApi().get_transcript(
                video_id, self.languages)
        )

        lines = []
        for transcript_piece in transcript_pieces:
            text = str(transcript_piece.get("text", "")).strip()
            if text:
                lines.append(text)
        return "\n".join(lines)


def parse_video_id(url: str) -> str:

    parsed_url = urlparse(url)

    if parsed_url.scheme not in {"http", "https"}:
        raise f"unsupported URL scheme: {parsed_url.scheme}"

    if parsed_url.netloc not in ALLOWED_NETLOCS:
        raise f"unsupported URL netloc: {parsed_url.netloc}"

    path = parsed_url.path

    if path.endswith("/watch"):
        query = parsed_url.query
        parsed_query = parse_qs(query)
        if "v" in parsed_query:
            ids = parsed_query["v"]
            video_id = ids if isinstance(ids, str) else ids[0]
        else:
            raise f"no video found in URL: {url}"
    else:
        path = parsed_url.path.lstrip("/")
        video_id = path.split("/")[-1]

    if len(video_id) != 11:  # Video IDs are 11 characters long
        raise f"invalid video ID: {video_id}"

    return video_id


def get_youtube_videos(channel_url):

    ydl_opts = {
        "extract_flat": True,
        "quiet": True,
    }
    with YoutubeDL(ydl_opts) as ydl:
        info = ydl.extract_info(channel_url, download=False)

    video_list = [
        {"title": entry["title"], "url": entry["url"]}
        for entry in info.get("entries", [])
    ]
    return video_list


# 定義食譜的內容
class Ingredient(BaseModel):
    name: str
    quantity: str
    unit: str
    preparation: str

class Step(BaseModel):
    description: str

class Recipe(BaseModel):
    title: str
    ingredients: list[Ingredient]
    steps: Step

def main():

    load_dotenv(find_dotenv())

    client = OpenAI()
    yt_loader = YoutubeLoader()
    url = "https://youtu.be/smD_6Ranb4g"
    content = yt_loader.load(url)
    prompt = """
    從字幕中抽取食譜資訊，不要捏造任何資訊。
    抽取後請務必將所有內容翻譯成台灣繁體中文。"""
    completion = client.beta.chat.completions.parse(
        model="gpt-4o-mini-2024-07-18",
        messages=[
            {"role": "system", "content": prompt},
            {"role": "user", "content": f"字幕：{content}"},
        ],
        response_format=Recipe,
    )
    markdown_recipe = completion.choices[0].message.content



if __name__ == "__main__":

    main()

```


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Recipe</span><span style="font-weight: bold">(</span>
    <span style="color: #808000; text-decoration-color: #808000">title</span>=<span style="color: #008000; text-decoration-color: #008000">'和風鰤魚＋大根'</span>,
    <span style="color: #808000; text-decoration-color: #808000">ingredients</span>=<span style="font-weight: bold">[</span>
        <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Ingredient</span><span style="font-weight: bold">(</span><span style="color: #808000; text-decoration-color: #808000">name</span>=<span style="color: #008000; text-decoration-color: #008000">'鰤魚粗'</span>, <span style="color: #808000; text-decoration-color: #808000">quantity</span>=<span style="color: #008000; text-decoration-color: #008000">'適量'</span>, <span style="color: #808000; text-decoration-color: #808000">unit</span>=<span style="color: #008000; text-decoration-color: #008000">''</span>, <span style="color: #808000; text-decoration-color: #808000">preparation</span>=<span style="color: #008000; text-decoration-color: #008000">'清洗並去除腥味'</span><span style="font-weight: bold">)</span>,
        <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Ingredient</span><span style="font-weight: bold">(</span><span style="color: #808000; text-decoration-color: #808000">name</span>=<span style="color: #008000; text-decoration-color: #008000">'大根'</span>, <span style="color: #808000; text-decoration-color: #808000">quantity</span>=<span style="color: #008000; text-decoration-color: #008000">'適量'</span>, <span style="color: #808000; text-decoration-color: #808000">unit</span>=<span style="color: #008000; text-decoration-color: #008000">''</span>, <span style="color: #808000; text-decoration-color: #808000">preparation</span>=<span style="color: #008000; text-decoration-color: #008000">'去皮並切成半月形'</span><span style="font-weight: bold">)</span>,
        <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Ingredient</span><span style="font-weight: bold">(</span><span style="color: #808000; text-decoration-color: #808000">name</span>=<span style="color: #008000; text-decoration-color: #008000">'長蔥'</span>, <span style="color: #808000; text-decoration-color: #808000">quantity</span>=<span style="color: #008000; text-decoration-color: #008000">'適量'</span>, <span style="color: #808000; text-decoration-color: #808000">unit</span>=<span style="color: #008000; text-decoration-color: #008000">''</span>, <span style="color: #808000; text-decoration-color: #808000">preparation</span>=<span style="color: #008000; text-decoration-color: #008000">'切成白髮蔥與青蔥部分分開備用'</span><span style="font-weight: bold">)</span>,
        <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Ingredient</span><span style="font-weight: bold">(</span><span style="color: #808000; text-decoration-color: #808000">name</span>=<span style="color: #008000; text-decoration-color: #008000">'生薑'</span>, <span style="color: #808000; text-decoration-color: #808000">quantity</span>=<span style="color: #008000; text-decoration-color: #008000">'適量'</span>, <span style="color: #808000; text-decoration-color: #808000">unit</span>=<span style="color: #008000; text-decoration-color: #008000">''</span>, <span style="color: #808000; text-decoration-color: #808000">preparation</span>=<span style="color: #008000; text-decoration-color: #008000">'清洗並切成薄片與細絲'</span><span style="font-weight: bold">)</span>,
        <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Ingredient</span><span style="font-weight: bold">(</span><span style="color: #808000; text-decoration-color: #808000">name</span>=<span style="color: #008000; text-decoration-color: #008000">'清酒'</span>, <span style="color: #808000; text-decoration-color: #808000">quantity</span>=<span style="color: #008000; text-decoration-color: #008000">'大量'</span>, <span style="color: #808000; text-decoration-color: #808000">unit</span>=<span style="color: #008000; text-decoration-color: #008000">''</span>, <span style="color: #808000; text-decoration-color: #808000">preparation</span>=<span style="color: #008000; text-decoration-color: #008000">''</span><span style="font-weight: bold">)</span>,
        <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Ingredient</span><span style="font-weight: bold">(</span><span style="color: #808000; text-decoration-color: #808000">name</span>=<span style="color: #008000; text-decoration-color: #008000">'水'</span>, <span style="color: #808000; text-decoration-color: #808000">quantity</span>=<span style="color: #008000; text-decoration-color: #008000">'適量'</span>, <span style="color: #808000; text-decoration-color: #808000">unit</span>=<span style="color: #008000; text-decoration-color: #008000">''</span>, <span style="color: #808000; text-decoration-color: #808000">preparation</span>=<span style="color: #008000; text-decoration-color: #008000">''</span><span style="font-weight: bold">)</span>,
        <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Ingredient</span><span style="font-weight: bold">(</span><span style="color: #808000; text-decoration-color: #808000">name</span>=<span style="color: #008000; text-decoration-color: #008000">'中皿糖'</span>, <span style="color: #808000; text-decoration-color: #808000">quantity</span>=<span style="color: #008000; text-decoration-color: #008000">'適量'</span>, <span style="color: #808000; text-decoration-color: #808000">unit</span>=<span style="color: #008000; text-decoration-color: #008000">''</span>, <span style="color: #808000; text-decoration-color: #808000">preparation</span>=<span style="color: #008000; text-decoration-color: #008000">'主要用於去腥'</span><span style="font-weight: bold">)</span>,
        <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Ingredient</span><span style="font-weight: bold">(</span><span style="color: #808000; text-decoration-color: #808000">name</span>=<span style="color: #008000; text-decoration-color: #008000">'醬油'</span>, <span style="color: #808000; text-decoration-color: #808000">quantity</span>=<span style="color: #008000; text-decoration-color: #008000">'適量'</span>, <span style="color: #808000; text-decoration-color: #808000">unit</span>=<span style="color: #008000; text-decoration-color: #008000">''</span>, <span style="color: #808000; text-decoration-color: #808000">preparation</span>=<span style="color: #008000; text-decoration-color: #008000">''</span><span style="font-weight: bold">)</span>
    <span style="font-weight: bold">]</span>,
    <span style="color: #808000; text-decoration-color: #808000">steps</span>=<span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Step</span><span style="font-weight: bold">(</span>
        <span style="color: #808000; text-decoration-color: #808000">description</span>=<span style="color: #008000; text-decoration-color: #008000">'1. 大根去皮並切成約2-3cm的半月切，備用。\n2. </span>
<span style="color: #008000; text-decoration-color: #008000">清洗鰤魚粗，去除表面血水，並以熱水燙過表面再立即用清水沖洗，去除腥味。\n3. 生薑切成兩種形式：薄片與細絲，備用。\n4.</span>
<span style="color: #008000; text-decoration-color: #008000">長蔥切成白髮蔥與青蔥部分分開備用，青蔥部分稍微壓碎以增香。\n5. 用寬型的鍋或平底鍋排放大根，加入清酒與水煮沸。\n6. </span>
<span style="color: #008000; text-decoration-color: #008000">將火調小，加入鰤魚粗，以及長蔥青蔥部分和生薑薄片同煮，以去腥。\n7. 加入中皿糖後繼續煮，去除浮沫。\n8. </span>
<span style="color: #008000; text-decoration-color: #008000">當煮沸後加入醬油，不蓋鍋蓋煮至水分減少，並不時將湯汁澆在食材上。\n9. 味道喜好程度煮至濃稠度適中，盛盤上桌。\n10. </span>
<span style="color: #008000; text-decoration-color: #008000">最後加入白髮蔥、生薑絲，喜好者可加入芥末增味，完成美味鰤大根。'</span>
    <span style="font-weight: bold">)</span>
<span style="font-weight: bold">)</span>
</pre>



                  </textarea>
                </section>
              
            </section>
          
        
          
            <section>
              
                <section data-markdown>
                  <textarea data-template>
                    

- <font color='#646464'>前言</font>
- <font color='#646464'>爬</font>
# 嵌- 嵌入向量
    - Chunk
    - Vector Database
- <font color='#646464'>問</font>



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    


![](media/embedding.jpeg)


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## `Chunk` 

- 切分前先做成 `Markdown` 格式
- 利用 `RecursiveCharacterTextSplitter` 拆分
    - 依照 `separators` 拆分
        - `["#", "##", "###", "\n\n", "\n"]`
    - 再依照 `chunk_size` 拆分


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

### `Chunk` 範例

```python 
from langchain.docstore.document import Documente
from langchain.text_splitter import RecursiveCharacterTextSplitter

doc = Document(
    page_content=markdown_text, 
    metadata={"dataset": dataset, "file": markdown_file}
    )

markdown_splitter = RecursiveCharacterTextSplitter(
    separators=["#", "##", "###", "\n\n", "\n", " "],
    chunk_size=1000,  # 可根據需求調整 chunk 大小
    chunk_overlap=100,  # 重疊區域，避免語境斷裂
)
documents = markdown_splitter.split_documents([doc])
```


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## Vector Database
### `Langchain` +
# `Qdrant`


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

<!-- .slide: data-background="media/qdrant.png" -->


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

### `Qdrant with Docker`

```bash
docker run -d -p 6333:6333 qdrant/qdrant
```
http://localhost:6333/dashboard


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

<!-- .slide: data-background="media/qdrant_dashboard.png" -->


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

### `Embedding Sample Code`

```python [1-3|13-20 | 21-29]
doc = Document(
    page_content=markdown_text, 
    metadata={"dataset": dataset, "file": markdown_file}
)

markdown_splitter = RecursiveCharacterTextSplitter(
    separators=["#", "##", "###", "\n\n", "\n", " "],
    chunk_size=1000,  # 可根據需求調整 chunk 大小
    chunk_overlap=100,  # 重疊區域，避免語境斷裂
)
documents = markdown_splitter.split_documents([doc])

from langchain_openai import AzureOpenAIEmbeddings
embedding_llm = AzureOpenAIEmbeddings(
    azure_endpoint=config.get("AZURE_OPENAI_ENDPOINT"),
    azure_deployment=config.get("AZURE_OPENAI_Embedding_DEPLOYMENT_NAME"),
    api_key=config.get("AZURE_OPENAI_KEY"),
    openai_api_version=config.get("AZURE_OPENAI_API_VERSION"),
    )

from langchain_qdrant import QdrantVectorStore
qdrant = QdrantVectorStore.from_documents(
    documents,
    embedding=embedding_llm,
    url="http://localhost:6333",
    collection_name=collection,
)

```


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

<!-- .slide: data-background="media/qdrant_filter.png" -->



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

<!-- .slide: data-background="media/qdrant_filter.png" -->


```
metadata.dataset:"recipe"
```


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

### `Qdrant` 的注意事項

- 使用多個 collection 的代價就是系統資源的消耗
- 建議單一個 Collection 拆分給不同使用者使用
- 可以利用 Payload 切分資料




                  </textarea>
                </section>
              
            </section>
          
        
          
            <section>
              
                <section data-markdown>
                  <textarea data-template>
                    


- <font color='#646464'>前言</font>
- <font color='#646464'>爬</font>
- <font color='#646464'>嵌</font>
# 問- 問你的Bot
    - 前端互動的頁面
    - 後端回答的機器人
    
    

                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## 前端互動的頁面

### `streamlit`


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

### `streamlit sample code`

```python [1-3|5-9|11-18|20-39]
# set select box for dataset
dataset_name = st.sidebar.selectbox(
    "請選擇要查詢的資料集名稱", options=datasets)

# session state
if "chat_history" not in st.session_state:
    st.session_state.chat_history = [
        AIMessage(content="Hello, I am a bot. How can I help you?"),
    ]

# conversation
for message in st.session_state.chat_history:
    if isinstance(message, AIMessage):
        with st.chat_message("AI"):
            st.write(message.content)
    elif isinstance(message, HumanMessage):
        with st.chat_message("Human"):
            st.write(message.content)

# user input
user_query = st.chat_input("Type your message here...")
if user_query is not None and user_query != "":
    st.session_state.chat_history.append(
        HumanMessage(content=user_query))

    with st.chat_message("Human"):
        st.markdown(user_query)
    with st.chat_message("AI"):
        response = st.write_stream(
            get_response(
                user_query=user_query,
                chat_history=st.session_state.chat_history[-10:],
                collection_name="bootcamp",
                dataset_name=dataset_name,
            )
        )

    st.session_state.chat_history.append(
        AIMessage(content=response))


```


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## 後端回答的機器人
### `Qdrant` +
# `Langchain`


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

### 後端回答的機器人

```python [4-17|18-26|27-33]
def get_response(
    user_query, chat_history, collection_name
):
    generator_llm = AzureChatOpenAI()
    system_prompt = (
        "你是一位專門根據文件回答問題的 AI 助手。"
        "如果你無法從文件得到答案，請說你不知道。"
        "請根據以下參考資料回答問題："
        "歷史紀錄：{chat_history}"
        "參考資料：{context}"
    )
    prompt = ChatPromptTemplate.from_messages(
        [("system", system_prompt), ("human", "{input}")]
    )
    question_answer_chain = create_stuff_documents_chain(
        generator_llm, prompt)
    
    embedding_llm = AzureOpenAIEmbeddings()
    client = QdrantClient(url="http://localhost:6333")
    qdrant = QdrantVectorStore(
        client=client, 
        collection_name=collection_name, 
        embedding=embedding_llm
    )
    retriever = qdrant.as_retriever(
        search_kwargs={"k": 3})

    rag_chain = create_retrieval_chain(
        retriever, question_answer_chain)
    chain = rag_chain.pick("answer")
    return chain.stream({
        "input": user_query, 
        "chat_history": chat_history})


```




                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

<!-- .slide: data-background="media/streamlit.png" -->



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

<!-- .slide: data-background="media/streamlit_switch.png" -->



                  </textarea>
                </section>
              
            </section>
          
        
          
            
              <section data-markdown>
                <textarea data-template>
                  

## 總結

- Markdown 格式幾乎到處都用得到
- 爬蟲好幫手：SingleFile + Structured Output
- 方便的向量資料庫：Qdrant
- 簡單好上手的 chatbot 介面：Streamlit


                </textarea>
              </section>
            
          
        
          
            <section>
              
                <section data-markdown>
                  <textarea data-template>
                    


## 投影片 + `Code`
![](media/QR_github.png)


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

## `Facebook`


<img src=media/QR_R_Ladies_Taipei.png width=50%></img><img src=media/QR_Ben_facebook.png width=50%></img>


                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

<!-- .slide: data-background-iframe="https://www.accupass.com/event/2502151309037693459180" -->



                  </textarea>
                </section>
              
                <section data-markdown>
                  <textarea data-template>
                    

<!-- .slide: data-background-iframe="https://www.accupass.com/event/2502151309037693459180" -->

![](media/QR_global_ai_bootcamp.png)




                  </textarea>
                </section>
              
            </section>
          
        
          
            
              <section data-markdown>
                <textarea data-template>
                  

# Thank you~

                </textarea>
              </section>
            
          
        
      </div>

    </div>

    <!-- Reveal.js script -->
    <script src="static/revealjs/dist/reveal.js"></script>

    <!-- Reveal.js plugins -->
    <script src="static/revealjs/plugin/markdown/markdown.js"></script>
    <script src="static/revealjs/plugin/highlight/highlight.js"></script>
    <script src="static/revealjs/plugin/search/search.js"></script>
    <script src="static/revealjs/plugin/notes/notes.js"></script>
    <script src="static/revealjs/plugin/math/math.js"></script>
    <script src="static/revealjs/plugin/zoom/zoom.js"></script>

    <script>
      Reveal.initialize({
        math: {
          mathjax: 'static/mathjax/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          // pass other options into `MathJax.Hub.Config()`
          TeX: { Macros: { RR: "{\\bf R}" } }
        },
        plugins: [
          RevealMarkdown,
          RevealHighlight,
          RevealSearch,
          RevealNotes,
          RevealMath,
          RevealZoom
        ]
      });

      Reveal.configure({"autoAnimate": true, "autoAnimateDuration": 1.0, "autoAnimateEasing": "ease", "autoAnimateMatcher": null, "autoAnimateStyles": ["opacity", "color", "background-color", "padding", "font-size", "line-height", "letter-spacing", "border-width", "border-color", "border-radius", "outline", "outline-offset"], "autoAnimateUnmatched": true, "autoPlayMedia": null, "autoSlide": 0, "autoSlideMethod": null, "autoSlideStoppable": true, "backgroundTransition": "fade", "center": true, "controls": true, "controlsBackArrows": "faded", "controlsLayout": "bottom-right", "controlsTutorial": true, "defaultTiming": null, "disableLayout": false, "display": "block", "embedded": false, "focusBodyOnPageVisibilityChange": true, "fragmentInURL": true, "fragments": true, "hash": true, "hashOneBasedIndex": false, "help": true, "hideCursorTime": 5000, "hideInactiveCursor": true, "history": true, "keyboard": true, "keyboardCondition": null, "loop": false, "mobileViewDistance": 2, "mouseWheel": false, "navigationMode": "default", "overview": true, "pause": true, "pdfPageHeightOffset": -1, "pdfSeparateFragments": true, "postMessage": true, "preloadIframes": null, "previewLinks": false, "progress": true, "respondToHashChanges": true, "rtl": false, "showNotes": false, "showSlideNumber": "all", "shuffle": false, "slideNumber": false, "touch": true, "transition": "slide", "transitionSpeed": "default", "viewDistance": 3});
    </script>
  </body>
</html>